{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@clarkwinkelmann/group-invitation/webpack/bootstrap","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/define property getters","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/group-invitation/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['admin/app']\"","webpack://@clarkwinkelmann/group-invitation/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/group-invitation/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/Model']\"","webpack://@clarkwinkelmann/group-invitation/./src/common/Invitation.ts","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/components/GroupBadge']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/models/Group']\"","webpack://@clarkwinkelmann/group-invitation/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@clarkwinkelmann/group-invitation/./src/admin/components/GroupSelect.ts","webpack://@clarkwinkelmann/group-invitation/./src/admin/components/SettingsPage.ts","webpack://@clarkwinkelmann/group-invitation/./src/admin/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\nimport Group from 'flarum/common/models/Group';\n\nexport default class Invitation extends Model {\n    code = Model.attribute<string>('code');\n    hasUsagesLeft = Model.attribute<boolean>('hasUsagesLeft');\n    canUse = Model.attribute<boolean>('canUse');\n    usageCount = Model.attribute<number>('usageCount');\n    maxUsage = Model.attribute<number>('maxUsage');\n    createdAt = Model.attribute('createdAt', Model.transformDate);\n\n    group = Model.hasOne<Group>('group');\n\n    apiEndpoint() {\n        return '/group-invitations' + (this.exists ? '/' + (this.data as any).id : '');\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/GroupBadge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import {ClassComponent, Vnode} from 'mithril';\nimport app from 'flarum/admin/app';\nimport Group from 'flarum/common/models/Group';\nimport icon from 'flarum/common/helpers/icon';\n\ninterface GroupSelectAttrs {\n    onchange: (value: string) => void\n    value: string\n}\n\nexport default class GroupSelect implements ClassComponent<GroupSelectAttrs> {\n    view(vnode: Vnode<GroupSelectAttrs, this>) {\n        const {\n            onchange,\n            value,\n        } = vnode.attrs;\n\n        return m('span.Select', [\n            m('select.Select-input.FormControl', {\n                onchange: (event: Event) => {\n                    onchange((event.target as HTMLInputElement).value);\n                },\n                value,\n            }, [\n                m('option', {\n                    value: '',\n                    disabled: true,\n                    hidden: true,\n                }, app.translator.trans('clarkwinkelmann-group-invitation.admin.settings.placeholder.group')),\n                app.store\n                    .all<Group>('groups')\n                    .filter((group) => [Group.GUEST_ID, Group.MEMBER_ID].indexOf(group.id()!) === -1)\n                    .map((group) => m('option', {\n                        value: group.id()\n                    }, group.namePlural())),\n            ]),\n            icon('fas fa-sort', {className: 'Select-caret'}),\n        ]);\n    }\n}\n","import {Vnode} from 'mithril';\nimport app from 'flarum/admin/app';\nimport {ApiPayloadSingle} from 'flarum/common/Store';\nimport Button from 'flarum/common/components/Button';\nimport GroupBadge from 'flarum/common/components/GroupBadge';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport GroupSelect from './GroupSelect';\nimport Invitation from '../../common/Invitation';\n\nconst translationPrefix = 'clarkwinkelmann-group-invitation.admin.settings.';\n\nexport default class SettingsPage extends ExtensionPage {\n    invitations: Invitation[] | null = null;\n    newInvitationGroupId: string = '';\n    newInvitationMaxUsage: string = '';\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        app.store.find<Invitation[]>('group-invitations', {}).then(invitations => {\n            this.invitations = invitations;\n            m.redraw();\n        });\n\n        this.loading = false;\n    }\n\n    content() {\n        return m('.ExtensionPage-settings.GroupInvitationSettingsPage', m('.container', [\n            m('table', [\n                m('thead', m('tr', [\n                    m('th', app.translator.trans(translationPrefix + 'head.code')),\n                    m('th', app.translator.trans(translationPrefix + 'head.group')),\n                    m('th', app.translator.trans(translationPrefix + 'head.usage')),\n                    m('th'),\n                ])),\n                m('tbody', [\n                    this.invitations === null ? m('tr', m('td', LoadingIndicator.component())) : [\n                        this.invitations.map((invitation, index) => {\n                            const group = invitation.group();\n\n                            return m('tr', [\n                                m('td', m('a', {\n                                    href: app.forum.attribute('baseUrl') + '/get-role/' + invitation.code(),\n                                    target: '_blank',\n                                }, m('code', invitation.code()))),\n                                m('td', [\n                                    GroupBadge.component({\n                                        group,\n                                    }),\n                                    ' ',\n                                    group && group.namePlural(),\n                                ]),\n                                m('td', invitation.usageCount() + '/' + (invitation.maxUsage() === null ? app.translator.trans(translationPrefix + 'unlimited') : invitation.maxUsage())),\n                                m('td', Button.component({\n                                    className: 'Button Button--danger',\n                                    onclick: () => {\n                                        this.loading = true;\n\n                                        invitation.delete().then(() => {\n                                            this.loading = false;\n\n                                            this.invitations!.splice(index, 1);\n                                            m.redraw();\n                                        }).catch(e => {\n                                            this.loading = false;\n                                            m.redraw();\n                                            throw e;\n                                        });\n                                    },\n                                    loading: this.loading,\n                                }, app.translator.trans(translationPrefix + 'delete'))),\n                            ]);\n                        }),\n                        this.invitations.length === 0 ? m('tr.NoResultRow', m('td', {\n                            colspan: 4,\n                        }, m('em', app.translator.trans(translationPrefix + 'empty')))) : null,\n                    ],\n                    m('tr', [\n                        m('td', m('em', app.translator.trans(translationPrefix + 'placeholder.code'))),\n                        m('td', m(GroupSelect, {\n                            onchange: (value: string) => {\n                                this.newInvitationGroupId = value;\n                            },\n                            value: this.newInvitationGroupId,\n                        })),\n                        m('td', m('input.FormControl', {\n                            type: 'number',\n                            min: '0',\n                            onchange: (event: Event) => {\n                                const value = (event.target as HTMLInputElement).value;\n                                this.newInvitationMaxUsage = value === '0' ? '' : value;\n                            },\n                            value: this.newInvitationMaxUsage,\n                            placeholder: app.translator.trans(translationPrefix + 'placeholder.usage'),\n                        })),\n                        m('td', Button.component({\n                            className: 'Button Button--primary',\n                            onclick: () => {\n                                this.loading = true;\n\n                                app.request<ApiPayloadSingle>({\n                                    method: 'POST',\n                                    url: app.forum.attribute('apiUrl') + '/group-invitations',\n                                    body: {\n                                        groupId: this.newInvitationGroupId,\n                                        maxUsage: this.newInvitationMaxUsage,\n                                    }\n                                }).then(data => {\n                                    this.loading = false;\n\n                                    this.invitations!.push(app.store.pushPayload(data));\n                                    this.newInvitationGroupId = '';\n                                    this.newInvitationMaxUsage = '';\n                                    m.redraw();\n                                }).catch(e => {\n                                    this.loading = false;\n                                    m.redraw();\n                                    throw e;\n                                });\n                            },\n                            loading: this.loading,\n                            disabled: !this.newInvitationGroupId,\n                        }, app.translator.trans(translationPrefix + 'create'))),\n                    ]),\n                ]),\n            ]),\n        ]));\n    }\n}\n","import app from 'flarum/admin/app';\nimport Invitation from '../common/Invitation';\nimport SettingsPage from './components/SettingsPage';\n\napp.initializers.add('clarkwinkelmann-group-invitation', () => {\n    app.store.models['group-invitations'] = Invitation;\n\n    app.extensionData.for('clarkwinkelmann-group-invitation')\n        .registerPage(SettingsPage)\n        .registerPermission({\n            icon: 'fas fa-certificate',\n            label: app.translator.trans('clarkwinkelmann-group-invitation.admin.permissions.use'),\n            permission: 'clarkwinkelmann-group-invitation.use',\n        }, 'start');\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","Invitation","_Model","_this","_len","arguments","length","args","Array","_key","apply","concat","code","Model","hasUsagesLeft","canUse","usageCount","maxUsage","createdAt","group","apiEndpoint","this","exists","data","id","GroupSelect","view","vnode","_vnode$attrs","attrs","onchange","m","event","target","disabled","hidden","app","filter","Group","indexOf","map","namePlural","icon","className","translationPrefix","SettingsPage","_ExtensionPage","invitations","newInvitationGroupId","newInvitationMaxUsage","_proto","oninit","_this2","then","redraw","loading","content","_this3","LoadingIndicator","invitation","index","href","GroupBadge","Button","onclick","splice","e","colspan","type","min","placeholder","method","url","body","groupId","push","ExtensionPage","registerPage","registerPermission","label","permission"],"sourceRoot":""}